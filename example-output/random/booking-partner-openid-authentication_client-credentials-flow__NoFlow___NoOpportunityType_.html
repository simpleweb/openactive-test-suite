<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
</head>
<body>
<p><head>
  </p>
<style>
h2 {
    cursor: pointer;
    border-top-color: #CCC;
    border-top-width: 1px;
    border-top-style: solid;
    padding-top: 5px;
}
h2:hover {
    color: #0056b3; /* Example color change on hover */
}
</style>
<p></head></p>
<p><a href="summary.html" rel="noopener noreferrer" target="_blank">< Return to Summary</a> | File Generated: Fri Jan 31 2025 11:31:47 GMT+0000 (Coordinated Universal Time)</p>
<p><button id="collapseH2Button">Collapse All Sections</button>
<button id="showH2Button">Show All Sections</button>
<button id="collapseAllButFirstError">Show Only First Error</button></p>
<h1 id="bookingpartneropenidauthenticationclientcredentialsflow">booking-partner-openid-authentication &gt;&gt; client-credentials-flow</h1>
<p><strong>Booking Flow:</strong> </p>
<p><strong>Opportunity Type:</strong> </p>
<p><strong>Feature:</strong> Authentication / Booking Partner OpenID Authentication (Implemented) </p>
<p><strong>Test:</strong>  Client Credentials Flow</p>
<p>Client Credentials Flow allows Booking Partners to access the Orders Feed</p>
<h3 id="runningonlythistest">Running only this test</h3>
<pre><code class="bash language-bash">npm start -- --runInBand test/features/authentication/booking-partner-openid-authentication/implemented/client-credentials-flow-test.js
</code></pre>
<h3 id="isthistestfailing">Is this test failing?</h3>
<p>The <a href="https://openactive.io/openactive-test-suite/example-output/random/booking-partner-openid-authentication_client-credentials-flow_undefined_undefined.html" rel="noopener noreferrer" target="_blank">OpenActive Reference Implementation test result for this test</a> can be used as a reference to help with debugging.</p>
<hr />
<p>✅ 3 passed with 0 failures, 0 warnings and 0 suggestions </p>
<hr />
<h2 id="openidconnectauthentication">✅ Open ID Connect Authentication</h2>
<h3 id="credentials">Credentials</h3>
<p>The test suite is using the credentials below for this test:</p>
<ul>
<li><strong>clientId</strong>: <code>5d883e30-34cb-4dfb-8a0a-8b43a40c5920</code></li>
<li><strong>clientSecret</strong>: <code>7QaS6Toi821fMx5pJ3IZapAzzeCPnMDmNW9mdQQj0Lm</code></li>
</ul>
<p>These credentials were retrieved using Dynamic Client Registration by the Broker Microservice upon startup, using the following configuration within <code>bookingPartners.primary.authentication</code>:</p>
<ul>
<li><strong>initialAccessToken</strong>: <code>openactive_test_suite_client_12345xaq</code></li>
</ul>
<h3 id="discoveryrequest">Discovery Request</h3>
<p>GET https://localhost:5003/.well-known/openid-configuration</p>
<ul>
<li><strong>accept:</strong> <code>"application/json"</code></li>
<li><strong>accept-encoding:</strong> <code>"gzip, deflate, br"</code></li>
<li><strong>host:</strong> <code>"localhost:5003"</code></li>
</ul>
<hr />
<p>Response status code: 200.</p>
<pre><code class="json language-json">{
  "issuer": "https://localhost:5003",
  "jwks_uri": "https://localhost:5003/.well-known/openid-configuration/jwks",
  "authorization_endpoint": "https://localhost:5003/connect/authorize",
  "token_endpoint": "https://localhost:5003/connect/token",
  "userinfo_endpoint": "https://localhost:5003/connect/userinfo",
  "end_session_endpoint": "https://localhost:5003/connect/endsession",
  "check_session_iframe": "https://localhost:5003/connect/checksession",
  "revocation_endpoint": "https://localhost:5003/connect/revocation",
  "introspection_endpoint": "https://localhost:5003/connect/introspect",
  "device_authorization_endpoint": "https://localhost:5003/connect/deviceauthorization",
  "frontchannel_logout_supported": true,
  "frontchannel_logout_session_supported": true,
  "backchannel_logout_supported": true,
  "backchannel_logout_session_supported": true,
  "scopes_supported": [
    "openid",
    "openactive-identity",
    "openactive-openbooking",
    "openactive-ordersfeed",
    "offline_access"
  ],
  "claims_supported": [
    "sub",
    "https://openactive.io/sellerId",
    "https://openactive.io/sellerName",
    "https://openactive.io/sellerUrl",
    "https://openactive.io/sellerLogo",
    "https://openactive.io/bookingServiceName",
    "https://openactive.io/bookingServiceUrl",
    "name",
    "https://openactive.io/clientId"
  ],
  "grant_types_supported": [
    "authorization_code",
    "client_credentials",
    "refresh_token",
    "implicit",
    "urn:ietf:params:oauth:grant-type:device_code"
  ],
  "response_types_supported": [
    "code",
    "token",
    "id_token",
    "id_token token",
    "code id_token",
    "code token",
    "code id_token token"
  ],
  "response_modes_supported": [
    "form_post",
    "query",
    "fragment"
  ],
  "token_endpoint_auth_methods_supported": [
    "client_secret_basic",
    "client_secret_post"
  ],
  "id_token_signing_alg_values_supported": [
    "RS256"
  ],
  "subject_types_supported": [
    "public"
  ],
  "code_challenge_methods_supported": [
    "plain",
    "S256"
  ],
  "request_parameter_supported": true,
  "registration_endpoint": "https://localhost:5003/connect/register"
}
</code></pre>
<h3 id="clientcredentialsflowrequest">Client Credentials Flow Request</h3>
<p>POST https://localhost:5003/connect/token</p>
<ul>
<li><strong>authorization:</strong> <code>"Basic NWQ4ODNlMzAtMzRjYi00ZGZiLThhMGEtOGI0M2E0MGM1OTIwOjdRYVM2VG9pODIxZk14NXBKM0laYXBBenplQ1BuTURtTlc5bWRRUWowTG0="</code></li>
<li><strong>accept:</strong> <code>"application/json"</code></li>
<li><strong>content-type:</strong> <code>"application/x-www-form-urlencoded"</code></li>
<li><strong>content-length:</strong> <code>"57"</code></li>
<li><strong>accept-encoding:</strong> <code>"gzip, deflate, br"</code></li>
<li><strong>host:</strong> <code>"localhost:5003"</code></li>
</ul>
<pre><code class="json language-json">"grant_type=client_credentials&amp;scope=openactive-ordersfeed"
</code></pre>
<hr />
<p>Response status code: 200.</p>
<pre><code class="json language-json">{
  "access_token": "eyJhbGciOiJSUzI1NiIsImtpZCI6IkIwNEY3QjkxREUzQjk0NzhDNjE4MzNGQjI0QUE1Q0RCIiwidHlwIjoiYXQrand0In0.eyJuYmYiOjE3MzgzMjMxMDcsImV4cCI6MTczODMyNjcwNywiaXNzIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NTAwMyIsImF1ZCI6Im9wZW5ib29raW5nIiwiY2xpZW50X2lkIjoiNWQ4ODNlMzAtMzRjYi00ZGZiLThhMGEtOGI0M2E0MGM1OTIwIiwiaHR0cHM6Ly9vcGVuYWN0aXZlLmlvL2NsaWVudElkIjoiNWQ4ODNlMzAtMzRjYi00ZGZiLThhMGEtOGI0M2E0MGM1OTIwIiwianRpIjoiNEIzQkRGM0U4Mzc4MjlGQjVCMzJGNzhFRkRDMzk5RDEiLCJpYXQiOjE3MzgzMjMxMDcsInNjb3BlIjpbIm9wZW5hY3RpdmUtb3JkZXJzZmVlZCJdfQ.ESKFiYsWq0IljAmuo5cSsbjkFFs8EVmkJreUogavEQjS4caEmLN7GJqq3dsv1nP2DjRtH2TCHJxiQ2-OlKeHKKPB_xOmMKkzdcJwJdk5_z_vKaLgjohYyyWZmUDlcuzcTCEbOtZ4v-OOjTvPNjA7l8203JJ6tBJcM_UyjAHcD1t24R4H46hRLSzWzmqRmgDoM6OGEeKX3BzMm4Z7xaQeVqUAIB4klvxN9uqAlHBg4imIVz-PXQhbZiqwaKx6au9u8_hZm12hzPBhwB_Eetl7wcLHzw0pEIj7_FA6Foq8y7MZNORs-iKQfGqnuKU4C6zDf_HpFYxFcd8n7wY_rnOYNQ",
  "expires_in": 3600,
  "token_type": "Bearer",
  "scope": "openactive-ordersfeed"
}
</code></pre>
<h3 id="specs">Specs</h3>
<ul>
<li>✅ should complete Discovery successfully</li>
<li>✅ should complete Client Credentials Flow successfully</li>
</ul>
<script>
  function collapseH2Section(nextElement) {
    while(nextElement && nextElement.tagName !== 'H2') {
        if (nextElement.style.display !== 'none') {
            nextElement.style.display = 'none';
        }
        nextElement = nextElement.nextElementSibling;
    }
  }

  function showH2Section(nextElement) {
    while(nextElement && nextElement.tagName !== 'H2') {
        if (nextElement.style.display !== '') {
            nextElement.style.display = '';
        }
        nextElement = nextElement.nextElementSibling;
    }
  }

  function toggleH2Section(nextElement) {
    while(nextElement && nextElement.tagName !== 'H2') {
              // Toggle visibility
              nextElement.style.display = nextElement.style.display === 'none' ? '' : 'none';
              nextElement = nextElement.nextElementSibling;
          }
  }

  function collapseAllH2Sections() {
    var h2Elements = document.querySelectorAll('h2');
    h2Elements.forEach(function(h2) {
        var nextElement = h2.nextElementSibling;
        collapseH2Section(nextElement);
    });
  }
  function showAllH2Sections() {
    var h2Elements = document.querySelectorAll('h2');
    h2Elements.forEach(function(h2) {
        var nextElement = h2.nextElementSibling;
        showH2Section(nextElement);
    });
  }

  function collapseExceptFirstSpecialH2Section() {
    const h2Elements = document.querySelectorAll('h2');
    let specialSectionFound = false;

    h2Elements.forEach((h2) => {
        let nextNode = h2.nextElementSibling;
        let sectionContainsSpecialChar = false;

        // Iterate through sibling elements until the next H2 or no more siblings until the error section is found
        while (nextNode && nextNode.tagName !== 'H2') {
            if (!specialSectionFound && nextNode.textContent.includes('❌')) {
                sectionContainsSpecialChar = true;
                specialSectionFound = true; 
                break;
              }
              showH2Section(nextNode);
            nextNode = nextNode.nextElementSibling;
        }

        // If this section is not the one with the error, collapse it
        if (!sectionContainsSpecialChar) {
            nextNode = h2.nextElementSibling; 
            collapseH2Section(nextNode);
        }
    });
}


  // Show/Hide each header section
  document.querySelectorAll('h2').forEach(function(h2) {
      h2.addEventListener('click', function() {
          let nextElement = this.nextElementSibling;
          toggleH2Section(nextElement)
      });
  });

  // Show all header sections
  document.getElementById('showH2Button').addEventListener('click', function() {
      showAllH2Sections();
  });

  // Collapse all header sections
  document.getElementById('collapseH2Button').addEventListener('click', function() {
      collapseAllH2Sections();
  });

  // Collapse all but first error section button
    document.getElementById('collapseAllButFirstError').addEventListener('click', function() {
      collapseExceptFirstSpecialH2Section();
  });

  // Hide all header sections by default
  collapseExceptFirstSpecialH2Section();
  </script>
<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"></p>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>